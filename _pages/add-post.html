---
layout: none
permalink: /add-post/
sitemap: false
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>Add Post</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #f5f5f5;
      --card: #fff;
      --border: #ddd;
      --accent: #2563eb;
      --accent-dark: #1d4ed8;
      --text: #1a1a1a;
      --muted: #666;
      --danger: #dc2626;
      --success: #16a34a;
      --radius: 10px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100dvh;
      padding: 16px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    h1 { font-size: 1.4rem; font-weight: 700; }

    .settings-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 1.1rem;
      cursor: pointer;
      color: var(--text);
    }

    /* Settings popover */
    .popover-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 100;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 60px 16px 0;
    }
    .popover-overlay.open { display: flex; }
    .popover {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      width: min(320px, 100%);
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    }
    .popover h2 { font-size: 1rem; margin-bottom: 12px; }
    .popover label { display: block; font-size: 0.85rem; color: var(--muted); margin-bottom: 4px; }
    .popover input {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 0.9rem;
      font-family: monospace;
      margin-bottom: 10px;
    }
    .popover .hint { font-size: 0.78rem; color: var(--muted); margin-bottom: 12px; }
    .popover-actions { display: flex; gap: 8px; }

    /* Form card */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }

    .field { margin-bottom: 14px; }
    .field label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .field input[type="text"],
    .field input[type="date"],
    .field textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 1rem;
      font-family: inherit;
      background: var(--bg);
      color: var(--text);
      transition: border-color 0.15s;
    }
    .field input:focus,
    .field textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    .field textarea { min-height: 180px; resize: vertical; }

    /* File input */
    .file-label {
      display: inline-block;
      padding: 8px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      color: var(--text);
    }
    .file-name {
      display: block;
      margin-top: 6px;
      font-size: 0.82rem;
      color: var(--muted);
    }

    /* Submit button */
    .submit-btn {
      width: 100%;
      padding: 14px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: background 0.15s;
    }
    .submit-btn:active { background: var(--accent-dark); }
    .submit-btn:disabled { background: #93c5fd; cursor: default; }

    /* Generic buttons */
    .btn {
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid transparent;
      transition: opacity 0.15s;
    }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-secondary { background: none; border-color: var(--border); color: var(--text); }

    /* Status banner */
    #status {
      display: none;
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      white-space: pre-line;
    }
    #status.success { display: block; background: #dcfce7; color: var(--success); }
    #status.error   { display: block; background: #fee2e2; color: var(--danger); }
    #status.info    { display: block; background: #eff6ff; color: var(--accent); }

    /* Crop modal */
    .crop-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 200;
      flex-direction: column;
    }
    .crop-modal.open { display: flex; }

    .crop-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: #111;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      flex-shrink: 0;
    }
    .crop-header .btn {
      color: #fff;
      border-color: rgba(255,255,255,0.3);
      font-size: 0.85rem;
      padding: 6px 12px;
    }

    .crop-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    #crop-img {
      max-width: 100%;
      max-height: 100%;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }

    #crop-box {
      position: absolute;
      border: 2px solid #fff;
      box-shadow: 0 0 0 9999px rgba(0,0,0,0.5);
      cursor: move;
      touch-action: none;
    }

    .crop-handle {
      position: absolute;
      width: 22px;
      height: 22px;
      background: #fff;
      border-radius: 3px;
      touch-action: none;
    }
    .crop-handle.tl { top: -11px; left: -11px; }
    .crop-handle.tr { top: -11px; right: -11px; }
    .crop-handle.bl { bottom: -11px; left: -11px; }
    .crop-handle.br { bottom: -11px; right: -11px; }

    .crop-footer {
      padding: 12px 16px;
      background: #111;
      flex-shrink: 0;
    }

    /* Preview */
    #preview-block {
      display: none;
      margin-top: 14px;
    }
    #preview-block summary {
      cursor: pointer;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    #preview-content {
      background: #f8f8f8;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      font-family: monospace;
      font-size: 0.8rem;
      white-space: pre-wrap;
      word-break: break-all;
      color: var(--text);
    }
  </style>
</head>
<body>

<header>
  <h1>Add Post</h1>
  <button class="settings-btn" id="settings-open" aria-label="Settings">&#x2699;&#xFE0F;</button>
</header>

<!-- Settings popover -->
<div class="popover-overlay" id="popover-overlay">
  <div class="popover">
    <h2>Settings</h2>
    <label for="pat-input">GitHub Personal Access Token</label>
    <input type="password" id="pat-input" placeholder="github_pat_…" autocomplete="off" spellcheck="false">
    <p class="hint">
      Fine-grained: <em>Contents → Read &amp; write</em><br>
      Classic: <em>repo</em> scope<br>
      Stored in browser localStorage on this device.
    </p>
    <div class="popover-actions">
      <button class="btn btn-primary" id="pat-save">Save</button>
      <button class="btn btn-secondary" id="pat-cancel">Cancel</button>
    </div>
  </div>
</div>

<!-- Crop modal -->
<div id="crop-modal" class="crop-modal">
  <div class="crop-header">
    <button id="crop-cancel" class="btn">Cancel</button>
    <span>Crop Photo</span>
    <button id="crop-reset" class="btn">Reset</button>
  </div>
  <div class="crop-container" id="crop-container">
    <img id="crop-img" alt="" draggable="false">
    <div id="crop-box">
      <div class="crop-handle tl"></div>
      <div class="crop-handle tr"></div>
      <div class="crop-handle bl"></div>
      <div class="crop-handle br"></div>
    </div>
  </div>
  <div class="crop-footer">
    <button id="crop-confirm" class="submit-btn">Use Photo</button>
  </div>
</div>

<!-- Main form -->
<div class="card">
  <form id="post-form" novalidate>

    <div class="field">
      <label for="title">Title *</label>
      <input type="text" id="title" required autocorrect="off" autocapitalize="words">
    </div>

    <div class="field">
      <label for="post-date">Date *</label>
      <input type="date" id="post-date" required>
    </div>

    <div class="field">
      <label for="excerpt">Excerpt</label>
      <input type="text" id="excerpt" placeholder="One-line teaser…" autocorrect="on" autocapitalize="sentences">
    </div>

    <div class="field">
      <label for="body">Body <span style="font-weight:400;color:var(--muted)">(Markdown)</span></label>
      <textarea id="body" placeholder="Post content… (optional if photo is provided)" autocorrect="on" autocapitalize="sentences"></textarea>
    </div>

    <div class="field">
      <label>Photo</label>
      <label class="file-label" for="photo">Choose photo…</label>
      <input type="file" id="photo" accept="image/*" style="display:none">
      <span class="file-name" id="file-name"></span>
    </div>

    <button type="submit" class="submit-btn" id="submit-btn">Add Post</button>
  </form>

  <div id="status"></div>

  <details id="preview-block">
    <summary>Preview generated file</summary>
    <pre id="preview-content"></pre>
  </details>
</div>

<script>
  // ── Crop state ─────────────────────────────────────────────────────────────

  let cropRegion = null;      // { sx, sy, sw, sh } in natural image px; null = full image
  let pendingPhotoFile = null; // File being cropped

  // ── Helpers ────────────────────────────────────────────────────────────────

  function slugify(title) {
    return title.toLowerCase()
      .replace(/&/g, 'and')
      .replace(/['\u2018\u2019]/g, '')
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '');
  }

  function toBase64Unicode(str) {
    return btoa(unescape(encodeURIComponent(str)));
  }

  function pad2(n) { return String(n).padStart(2, '0'); }

  function todayISO() {
    const d = new Date();
    return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
  }

  function buildDatetime(dateStr) {
    const d = new Date();
    const [y, m, day] = dateStr.split('-');
    const dt = new Date(+y, +m - 1, +day, d.getHours(), d.getMinutes());
    const off = -dt.getTimezoneOffset();
    const sign = off >= 0 ? '+' : '-';
    const hh = pad2(Math.floor(Math.abs(off) / 60));
    const mm2 = pad2(Math.abs(off) % 60);
    return `${y}-${m}-${day}T${pad2(dt.getHours())}:${pad2(dt.getMinutes())}:00${sign}${hh}:${mm2}`;
  }

  // ── PAT storage ────────────────────────────────────────────────────────────

  const patInput = document.getElementById('pat-input');
  const overlay  = document.getElementById('popover-overlay');

  function loadPAT() {
    patInput.value = localStorage.getItem('gh_pat') || '';
  }

  document.getElementById('settings-open').addEventListener('click', () => {
    loadPAT();
    overlay.classList.add('open');
  });
  document.getElementById('pat-cancel').addEventListener('click', () => {
    overlay.classList.remove('open');
  });
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('open');
  });
  document.getElementById('pat-save').addEventListener('click', () => {
    localStorage.setItem('gh_pat', patInput.value.trim());
    overlay.classList.remove('open');
  });

  // ── Default date ───────────────────────────────────────────────────────────

  document.getElementById('post-date').value = todayISO();

  // ── Photo change → open crop modal ────────────────────────────────────────

  document.getElementById('photo').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) { cropRegion = null; document.getElementById('file-name').textContent = ''; return; }
    openCropModal(file);
  });

  // ── Crop modal ─────────────────────────────────────────────────────────────

  function openCropModal(file) {
    pendingPhotoFile = file;
    const url = URL.createObjectURL(file);
    const img = document.getElementById('crop-img');
    img.onload = () => {
      URL.revokeObjectURL(url);
      initCropBox();
    };
    img.src = url;
    document.getElementById('crop-modal').classList.add('open');
  }

  function initCropBox() {
    const container = document.getElementById('crop-container');
    const img       = document.getElementById('crop-img');
    const box       = document.getElementById('crop-box');
    const cRect = container.getBoundingClientRect();
    const iRect = img.getBoundingClientRect();
    box.style.left   = (iRect.left - cRect.left) + 'px';
    box.style.top    = (iRect.top  - cRect.top)  + 'px';
    box.style.width  = iRect.width  + 'px';
    box.style.height = iRect.height + 'px';
  }

  function getImgRect() {
    const c = document.getElementById('crop-container').getBoundingClientRect();
    const i = document.getElementById('crop-img').getBoundingClientRect();
    return { left: i.left - c.left, top: i.top - c.top, width: i.width, height: i.height };
  }

  // Drag handlers for crop box (move) and handles (resize)
  (function () {
    const cropBox = document.getElementById('crop-box');
    const MIN_SIZE = 40;

    // Move entire box
    cropBox.addEventListener('pointerdown', e => {
      if (e.target.classList.contains('crop-handle')) return;
      e.preventDefault();
      cropBox.setPointerCapture(e.pointerId);
      const startX = e.clientX;
      const startY = e.clientY;
      const startLeft = parseFloat(cropBox.style.left);
      const startTop  = parseFloat(cropBox.style.top);
      const boxW = parseFloat(cropBox.style.width);
      const boxH = parseFloat(cropBox.style.height);

      function onMove(ev) {
        const ir = getImgRect();
        let newLeft = startLeft + (ev.clientX - startX);
        let newTop  = startTop  + (ev.clientY - startY);
        newLeft = Math.max(ir.left, Math.min(ir.left + ir.width  - boxW, newLeft));
        newTop  = Math.max(ir.top,  Math.min(ir.top  + ir.height - boxH, newTop));
        cropBox.style.left = newLeft + 'px';
        cropBox.style.top  = newTop  + 'px';
      }
      function onUp() {
        cropBox.removeEventListener('pointermove', onMove);
        cropBox.removeEventListener('pointerup',   onUp);
      }
      cropBox.addEventListener('pointermove', onMove);
      cropBox.addEventListener('pointerup',   onUp);
    });

    // Resize via corner handles
    document.querySelectorAll('.crop-handle').forEach(handle => {
      handle.addEventListener('pointerdown', e => {
        e.preventDefault();
        e.stopPropagation();
        handle.setPointerCapture(e.pointerId);
        const corner = Array.from(handle.classList).find(c => ['tl','tr','bl','br'].includes(c));
        const startLeft = parseFloat(cropBox.style.left);
        const startTop  = parseFloat(cropBox.style.top);
        const startW    = parseFloat(cropBox.style.width);
        const startH    = parseFloat(cropBox.style.height);
        // Anchor: opposite corner in container coords
        const anchorX = corner === 'tl' || corner === 'bl' ? startLeft + startW : startLeft;
        const anchorY = corner === 'tl' || corner === 'tr' ? startTop  + startH : startTop;

        function onMove(ev) {
          const ir = getImgRect();
          // Pointer position relative to container
          const cRect = document.getElementById('crop-container').getBoundingClientRect();
          let px = ev.clientX - cRect.left;
          let py = ev.clientY - cRect.top;
          // Clamp pointer to image bounds
          px = Math.max(ir.left, Math.min(ir.left + ir.width,  px));
          py = Math.max(ir.top,  Math.min(ir.top  + ir.height, py));

          let newLeft = Math.min(px, anchorX);
          let newTop  = Math.min(py, anchorY);
          let newW    = Math.abs(px - anchorX);
          let newH    = Math.abs(py - anchorY);

          // Enforce minimum size
          if (newW < MIN_SIZE) {
            newW = MIN_SIZE;
            newLeft = corner === 'tl' || corner === 'bl' ? anchorX - MIN_SIZE : anchorX;
          }
          if (newH < MIN_SIZE) {
            newH = MIN_SIZE;
            newTop = corner === 'tl' || corner === 'tr' ? anchorY - MIN_SIZE : anchorY;
          }

          cropBox.style.left   = newLeft + 'px';
          cropBox.style.top    = newTop  + 'px';
          cropBox.style.width  = newW    + 'px';
          cropBox.style.height = newH    + 'px';
        }
        function onUp() {
          handle.removeEventListener('pointermove', onMove);
          handle.removeEventListener('pointerup',   onUp);
        }
        handle.addEventListener('pointermove', onMove);
        handle.addEventListener('pointerup',   onUp);
      });
    });
  })();

  document.getElementById('crop-reset').addEventListener('click', initCropBox);

  document.getElementById('crop-cancel').addEventListener('click', () => {
    document.getElementById('crop-modal').classList.remove('open');
    document.getElementById('photo').value = '';
    document.getElementById('file-name').textContent = '';
    pendingPhotoFile = null;
    cropRegion = null;
  });

  document.getElementById('crop-confirm').addEventListener('click', () => {
    const img   = document.getElementById('crop-img');
    const box   = document.getElementById('crop-box');
    const iRect = getImgRect();
    const scaleX = img.naturalWidth  / img.clientWidth;
    const scaleY = img.naturalHeight / img.clientHeight;
    const bLeft  = parseFloat(box.style.left)   - iRect.left;
    const bTop   = parseFloat(box.style.top)    - iRect.top;
    const bW     = parseFloat(box.style.width);
    const bH     = parseFloat(box.style.height);
    cropRegion = {
      sx: Math.max(0, Math.round(bLeft * scaleX)),
      sy: Math.max(0, Math.round(bTop  * scaleY)),
      sw: Math.min(img.naturalWidth,  Math.round(bW * scaleX)),
      sh: Math.min(img.naturalHeight, Math.round(bH * scaleY)),
    };
    document.getElementById('file-name').textContent = pendingPhotoFile.name;
    document.getElementById('crop-modal').classList.remove('open');
  });

  // ── Image resize ───────────────────────────────────────────────────────────

  function loadImage(file) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      const url = URL.createObjectURL(file);
      img.onload = () => { URL.revokeObjectURL(url); resolve(img); };
      img.onerror = reject;
      img.src = url;
    });
  }

  async function resizeImage(file, crop) {
    const img = await loadImage(file);
    const sx = crop ? crop.sx : 0;
    const sy = crop ? crop.sy : 0;
    const sw = crop ? crop.sw : img.naturalWidth;
    const sh = crop ? crop.sh : img.naturalHeight;
    const scale = Math.min(1, 1600 / sw);
    const w = Math.round(sw * scale);
    const h = Math.round(sh * scale);
    const canvas = document.createElement('canvas');
    canvas.width = w; canvas.height = h;
    canvas.getContext('2d').drawImage(img, sx, sy, sw, sh, 0, 0, w, h);
    return canvas.toDataURL('image/jpeg', 0.85);
  }

  // ── Build post content ─────────────────────────────────────────────────────

  function buildContent(fields) {
    const { title, dateStr, excerpt, body, slug, photoFilename } = fields;
    const [y, m, day] = dateStr.split('-');
    const datetime = buildDatetime(dateStr);
    const permalink = `/blog/${y}/${m}/${day}/${slug}/`;

    let fm = '---\n';
    fm += `title: "${title.replace(/"/g, '\\"')}"\n`;
    fm += `date: ${datetime}\n`;
    if (excerpt) fm += `excerpt: "${excerpt.replace(/"/g, '\\"')}"\n`;
    fm += `type: post\n`;
    fm += `permalink: ${permalink}\n`;
    fm += '---\n';

    let content = fm;
    if (body.trim()) content += '\n' + body.trim();

    if (photoFilename) {
      const imgPath = `/assets/${y}/${m}/${dateStr}-${slug}/${photoFilename}`;
      content += `\n\n![no-alignment]({{ site.url }}{{ site.baseurl }}${imgPath})`;
    }

    return content + '\n';
  }

  // ── GitHub API helpers ─────────────────────────────────────────────────────

  async function pathExists(pat, path) {
    const res = await fetch(
      `https://api.github.com/repos/ginn5j/ginn5j.github.io/contents/${path}`,
      { headers: { 'Authorization': `token ${pat}`, 'Accept': 'application/vnd.github+json' } }
    );
    return res.status === 200;
  }

  async function getHeadOid(pat) {
    const res = await fetch(
      'https://api.github.com/repos/ginn5j/ginn5j.github.io/git/refs/heads/main',
      { headers: { 'Authorization': `token ${pat}`, 'Accept': 'application/vnd.github+json' } }
    );
    const data = await res.json();
    return data.object.sha;
  }

  async function createCommit(pat, message, additions) {
    const headOid = await getHeadOid(pat);
    const mutation = `
      mutation($input: CreateCommitOnBranchInput!) {
        createCommitOnBranch(input: $input) {
          commit { oid }
        }
      }`;
    const variables = {
      input: {
        branch: { repositoryNameWithOwner: 'ginn5j/ginn5j.github.io', branchName: 'main' },
        message: { headline: message },
        fileChanges: { additions },
        expectedHeadOid: headOid
      }
    };
    const res = await fetch('https://api.github.com/graphql', {
      method: 'POST',
      headers: { 'Authorization': `token ${pat}`, 'Content-Type': 'application/json' },
      body: JSON.stringify({ query: mutation, variables })
    });
    const json = await res.json();
    if (json.errors) throw new Error(json.errors[0].message);
    return json;
  }

  // ── Submit ─────────────────────────────────────────────────────────────────

  const form           = document.getElementById('post-form');
  const submitBtn      = document.getElementById('submit-btn');
  const statusEl       = document.getElementById('status');
  const previewBlock   = document.getElementById('preview-block');
  const previewContent = document.getElementById('preview-content');

  function showStatus(type, msg) {
    statusEl.className = type;
    statusEl.textContent = msg;
  }

  async function submitPost(fields, slug, attempt) {
    const pat = localStorage.getItem('gh_pat') || '';
    if (!pat) {
      showStatus('error', 'No GitHub PAT saved. Tap ⚙ to add one.');
      return;
    }

    const { dateStr, title, photoFile } = fields;
    const [yyyy, mm] = dateStr.split('-');
    const finalSlug = attempt === 2 ? slug + '-2' : slug;
    const postPath = `_posts/${yyyy}/${mm}/${dateStr}-${finalSlug}.md`;

    if (await pathExists(pat, postPath)) {
      if (attempt === 1) { await submitPost(fields, slug, 2); return; }
      showStatus('error', `File already exists: ${postPath}`);
      return;
    }

    // Build additions array (photo first, then post markdown)
    const additions = [];
    let photoFilename = null;

    if (photoFile) {
      showStatus('info', 'Processing photo…');
      const dataUrl = await resizeImage(photoFile, cropRegion);
      const base64 = dataUrl.replace(/^data:image\/jpeg;base64,/, '');
      photoFilename = photoFile.name.replace(/\.[^.]+$/, '.jpg');
      const photoPath = `assets/${yyyy}/${mm}/${dateStr}-${finalSlug}/${photoFilename}`;
      additions.push({ path: photoPath, contents: base64 });
    }

    const postFields = { ...fields, slug: finalSlug, photoFilename };
    const content = buildContent(postFields);

    previewContent.textContent = content;
    previewBlock.style.display = 'block';
    previewBlock.open = false;

    additions.push({ path: postPath, contents: toBase64Unicode(content) });

    showStatus('info', photoFile ? 'Uploading photo and saving post…' : 'Saving post…');

    try {
      await createCommit(pat, `Add post: ${title}`, additions);
      let successMsg = `✓ Added!\nPost: ${postPath}`;
      if (photoFilename) {
        successMsg += `\nPhoto: assets/${yyyy}/${mm}/${dateStr}-${finalSlug}/${photoFilename}`;
      }
      showStatus('success', successMsg);
      form.reset();
      cropRegion = null;
      pendingPhotoFile = null;
      document.getElementById('post-date').value = todayISO();
      document.getElementById('file-name').textContent = '';
    } catch (err) {
      showStatus('error', `Error: ${err.message}`);
    }
  }

  form.addEventListener('submit', async e => {
    e.preventDefault();

    const title    = document.getElementById('title').value.trim();
    const dateStr  = document.getElementById('post-date').value;
    const excerpt  = document.getElementById('excerpt').value.trim();
    const body     = document.getElementById('body').value;
    const photoFile = document.getElementById('photo').files[0] || null;

    // Validation
    if (!title)   { showStatus('error', 'Title is required.'); return; }
    if (!dateStr) { showStatus('error', 'Date is required.'); return; }
    if (!body.trim() && !photoFile) {
      showStatus('error', 'Please enter body text or select a photo (or both).');
      return;
    }

    const fields = { title, dateStr, excerpt, body, photoFile };
    const slug   = slugify(title);

    statusEl.className = '';
    statusEl.textContent = '';
    submitBtn.disabled = true;
    submitBtn.textContent = 'Adding…';

    try {
      await submitPost(fields, slug, 1);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add Post';
    }
  });
</script>
</body>
</html>
